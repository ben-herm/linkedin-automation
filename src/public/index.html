<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkedIn Automation Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="bg-gray-100">
    <div x-data="dashboard()" x-init="loadData()" class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-6">
                    <div class="flex items-center">
                        <h1 class="text-3xl font-bold text-gray-900">LinkedIn Automation</h1>
                        <span class="ml-4 px-2 py-1 bg-green-100 text-green-800 text-sm rounded-full" x-show="systemHealth">
                            üü¢ Active
                        </span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button @click="loadData()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                            Refresh
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Dashboard -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <!-- AUTOMATION PIPELINE OVERVIEW -->
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">üîÑ Automation Pipeline Overview</h2>
                
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6">
                    <!-- New Leads -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center hover:bg-blue-100 transition-colors cursor-pointer"
                         @click="showLeadsModal('NEW_LEAD', 'üÜï New Leads')">
                        <div class="text-2xl font-bold text-blue-600" x-text="getStateCount('NEW_LEAD')"></div>
                        <div class="text-sm font-medium text-blue-800">üÜï New Leads</div>
                        <div class="text-xs text-blue-600 mt-1">Ready to process</div>
                        <div class="text-xs text-blue-500 mt-2">Click to view list</div>
                    </div>

                    <!-- Connection Requests Sent -->
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center hover:bg-yellow-100 transition-colors cursor-pointer"
                         @click="showLeadsModal('CONNECTION_REQUEST_SENT', 'ü§ù Connection Requests Sent')">
                        <div class="text-2xl font-bold text-yellow-600" x-text="getStateCount('CONNECTION_REQUEST_SENT')"></div>
                        <div class="text-sm font-medium text-yellow-800">ü§ù Requests Sent</div>
                        <div class="text-xs text-yellow-600 mt-1">Awaiting acceptance</div>
                        <div class="text-xs text-yellow-500 mt-2">Click to view list</div>
                    </div>

                    <!-- Connections Accepted -->
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center hover:bg-green-100 transition-colors cursor-pointer"
                         @click="showLeadsModal('CONNECTION_ACCEPTED', '‚úÖ Connections Accepted')">
                        <div class="text-2xl font-bold text-green-600" x-text="getStateCount('CONNECTION_ACCEPTED')"></div>
                        <div class="text-sm font-medium text-green-800">‚úÖ Connected</div>
                        <div class="text-xs text-green-600 mt-1">Ready for messaging</div>
                        <div class="text-xs text-green-500 mt-2">Click to view list</div>
                    </div>

                    <!-- Messages Drafted -->
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 text-center hover:bg-purple-100 transition-colors cursor-pointer"
                         @click="showLeadsModal('FIRST_MESSAGE_DRAFTED', '‚úçÔ∏è Messages Drafted')">
                        <div class="text-2xl font-bold text-purple-600" x-text="getStateCount('FIRST_MESSAGE_DRAFTED')"></div>
                        <div class="text-sm font-medium text-purple-800">‚úçÔ∏è Drafted</div>
                        <div class="text-xs text-purple-600 mt-1">Awaiting approval</div>
                        <div class="text-xs text-purple-500 mt-2">Click to view list</div>
                    </div>

                    <!-- Got Replies -->
                    <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4 text-center hover:bg-indigo-100 transition-colors cursor-pointer"
                         @click="showUnreadRepliesModal()">
                        <div class="text-2xl font-bold text-indigo-600" x-text="stats.unrepliedResponsesCount || 0"></div>
                        <div class="text-sm font-medium text-indigo-800">üí¨ Replies</div>
                        <div class="text-xs text-indigo-600 mt-1">Need response</div>
                        <div class="text-xs text-indigo-500 mt-2">Click to view list</div>
                    </div>

                    <!-- Hot Leads -->
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4 text-center hover:bg-red-100 transition-colors cursor-pointer"
                         @click="showLeadsModal('HOT_LEAD', 'üî• Hot Leads')">
                        <div class="text-2xl font-bold text-red-600" x-text="getStateCount('HOT_LEAD')"></div>
                        <div class="text-sm font-medium text-red-800">üî• Hot Leads</div>
                        <div class="text-xs text-red-600 mt-1">Interested prospects</div>
                        <div class="text-xs text-red-500 mt-2">Click to view list</div>
                    </div>
                </div>

                <!-- Additional States Row -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <!-- Closed Lost -->
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 text-center hover:bg-gray-100 transition-colors cursor-pointer"
                         @click="showLeadsModal('CLOSED_LOST', '‚ùå Closed Lost')">
                        <div class="text-2xl font-bold text-gray-600" x-text="getStateCount('CLOSED_LOST')"></div>
                        <div class="text-sm font-medium text-gray-800">‚ùå Closed Lost</div>
                        <div class="text-xs text-gray-600 mt-1">Not interested</div>
                        <div class="text-xs text-gray-500 mt-2">Click to view list</div>
                    </div>

                    <!-- Daily Progress -->
                    <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4 text-center hover:bg-emerald-100 transition-colors cursor-pointer"
                         @click="showSentRequestsModal()">
                        <div class="text-2xl font-bold text-emerald-600">
                            <span x-text="stats.dailyLimits?.connection_requests_sent || 0"></span>
                            <span class="text-sm text-emerald-500">/ <span x-text="stats.dailyLimits?.limits?.connectionRequests || 10"></span></span>
                        </div>
                        <div class="text-sm font-medium text-emerald-800">üìà Today's Progress</div>
                        <div class="text-xs text-emerald-600 mt-1">Connections sent</div>
                        <div class="text-xs text-emerald-500 mt-2">Click to see who</div>
                    </div>

                    <!-- Total Active -->
                    <div class="bg-slate-50 border border-slate-200 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-slate-600" x-text="stats.initializedLeads || 0"></div>
                        <div class="text-sm font-medium text-slate-800">üìä Total Active</div>
                        <div class="text-xs text-slate-600 mt-1">In pipeline</div>
                    </div>

                    <!-- Uninitialized -->
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 text-center" x-show="stats.uninitializedLeads > 0">
                        <div class="text-2xl font-bold text-orange-600" x-text="stats.uninitializedLeads || 0"></div>
                        <div class="text-sm font-medium text-orange-800">‚ö†Ô∏è Not Started</div>
                        <div class="text-xs text-orange-600 mt-1">Need initialization</div>
                    </div>
                </div>
            </div>

            <!-- PENDING APPROVALS SECTION -->
            <div x-show="stats.pendingApprovals > 0" class="mb-8 bg-white shadow rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">‚è≥ Messages Pending Approval</h3>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800" x-text="stats.pendingApprovals + ' pending'"></span>
                    </div>
                    
                    <div x-show="!showPending" class="text-center">
                        <button @click="showPendingMessages()" class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded">
                            Review <span x-text="stats.pendingApprovals"></span> Messages ‚Üí
                        </button>
                    </div>

                    <div x-show="showPending">
                        <div x-show="pendingMessages.length === 0" class="text-center py-8 text-gray-500">
                            Loading messages...
                        </div>

                        <div class="space-y-4">
                            <template x-for="message in pendingMessages" :key="message.id">
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-3">
                                        <div>
                                            <h4 class="font-medium text-gray-900" x-text="message.name"></h4>
                                            <p class="text-sm text-gray-600" x-text="message.company + ' ‚Ä¢ ' + (message.title || 'Business Owner')"></p>
                                            <p class="text-xs text-gray-500" x-text="message.industry || 'Business'"></p>
                                        </div>
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800" x-text="(message.type || 'message').replace('_', ' ')"></span>
                                    </div>
                                    
                                    <div class="bg-gray-50 p-3 rounded mb-4">
                                        <p class="text-sm text-gray-700" x-text="message.content"></p>
                                    </div>

                                    <div class="flex justify-between items-center">
                                        <a :href="message.linkedin_url" target="_blank" class="text-blue-600 hover:text-blue-800 text-sm">
                                            View LinkedIn Profile ‚Üí
                                        </a>
                                        <div class="flex space-x-2">
                                            <button @click="approveMessage(message.id, false)" class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-3 rounded text-sm">
                                                Reject
                                            </button>
                                            <button @click="editMessage(message)" class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-1 px-3 rounded text-sm">
                                                Edit
                                            </button>
                                            <button @click="approveMessage(message.id, true)" class="bg-green-500 hover:bg-green-700 text-white font-bold py-1 px-3 rounded text-sm">
                                                Approve & Send
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <div x-show="pendingMessages.length > 0" class="mt-4 flex justify-between">
                            <button @click="bulkApprove(false)" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                                Reject All
                            </button>
                            <button @click="bulkApprove(true)" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                                Approve All
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- HOT LEADS SECTION -->
            <div x-show="stats.hotLeads?.length > 0" class="mb-8 bg-white shadow rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">üî• Hot Leads - Take Action Now!</h3>
                    
                    <div class="space-y-4">
                        <template x-for="lead in stats.hotLeads" :key="lead.id">
                            <div class="border-l-4 border-red-400 bg-red-50 p-4">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="font-medium text-red-800" x-text="lead.name"></h4>
                                        <p class="text-sm text-red-600" x-text="lead.company + ' ‚Ä¢ ' + (lead.title || 'Business Owner')"></p>
                                        <p class="text-sm text-red-700 mt-2" x-text="'\"' + (lead.last_response || '').substring(0, 100) + '...\"'"></p>
                                        <p class="text-xs text-red-500 mt-1" x-text="'Responded: ' + new Date(lead.received_at).toLocaleString()"></p>
                                    </div>
                                    <div class="flex space-x-2">
                                        <a :href="'mailto:' + lead.email" x-show="lead.email" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded text-sm">
                                            Email
                                        </a>
                                        <a :href="lead.linkedin_url" target="_blank" class="bg-blue-600 hover:bg-blue-800 text-white font-bold py-1 px-3 rounded text-sm">
                                            LinkedIn
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- ALL STATES DEBUG (OPTIONAL) -->
            <div x-show="showDebug" class="bg-white shadow rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">üîç All States (Debug)</h3>
                        <button @click="showDebug = false" class="text-gray-400 hover:text-gray-600">‚úï</button>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <template x-for="[state, count] in Object.entries(stats.leadsByState || {})" :key="state">
                            <div class="bg-gray-50 p-3 rounded">
                                <div class="text-lg font-bold text-gray-900" x-text="count"></div>
                                <div class="text-sm text-gray-600" x-text="state.replace(/_/g, ' ')"></div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Debug Toggle -->
            <div class="text-center mt-8">
                <button @click="showDebug = !showDebug" class="text-gray-500 hover:text-gray-700 text-sm">
                    <span x-show="!showDebug">Show All States</span>
                    <span x-show="showDebug">Hide Debug</span>
                </button>
            </div>
        </div>

        <!-- LEADS MODAL -->
        <div x-show="showModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="closeModal()">
            <div class="bg-white rounded-lg max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden">
                <!-- Modal Header -->
                <div class="bg-gray-50 px-6 py-4 border-b">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-bold text-gray-900" x-text="modalTitle"></h2>
                        <button @click="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <p class="text-sm text-gray-600 mt-1">
                        <span x-text="modalLeads.length"></span> leads in <span x-text="currentState"></span> state
                    </p>
                </div>

                <!-- Modal Body -->
                <div class="p-6 overflow-y-auto max-h-[60vh]">
                    <div x-show="loadingLeads" class="text-center py-8">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                        <p class="text-gray-600 mt-2">Loading leads...</p>
                    </div>

                    <div x-show="!loadingLeads && modalLeads.length === 0" class="text-center py-8">
                        <p class="text-gray-500">No leads found in this state.</p>
                    </div>

                    <div x-show="!loadingLeads && modalLeads.length > 0" class="space-y-3">
                        <template x-for="lead in modalLeads" :key="lead.id">
                            <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <h3 class="font-medium text-gray-900" x-text="lead.name"></h3>
                                        <p class="text-sm text-gray-600" x-text="lead.company"></p>
                                        <p class="text-xs text-gray-500" x-text="lead.title || 'Business Owner'"></p>
                                        <div x-show="currentState === 'UNREAD_REPLIES' && lead.content" class="mt-2 p-2 bg-blue-50 rounded border-l-4 border-blue-400">
                                            <p class="text-xs text-blue-600 font-medium mb-1">Latest Reply:</p>
                                            <p class="text-sm text-gray-700" x-text="lead.content"></p>
                                        </div>
                                        <p class="text-xs text-gray-400 mt-1" x-show="currentState !== 'SENT_TODAY' && currentState !== 'UNREAD_REPLIES'">
                                            State since: <span x-text="new Date(lead.state_since).toLocaleDateString()"></span>
                                        </p>
                                        <p class="text-xs text-gray-400 mt-1" x-show="currentState === 'SENT_TODAY'">
                                            Sent at: <span x-text="new Date(lead.sent_at || lead.state_since).toLocaleString()"></span>
                                        </p>
                                        <p class="text-xs text-gray-400 mt-1" x-show="currentState === 'UNREAD_REPLIES' && lead.response_timestamp">
                                            Replied at: <span x-text="new Date(lead.response_timestamp).toLocaleString()"></span>
                                        </p>
                                    </div>
                                    <div class="flex space-x-2 ml-4">
                                        <a :href="lead.linkedin_url" target="_blank" 
                                           class="bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium py-1 px-3 rounded transition-colors">
                                            LinkedIn ‚Üí
                                        </a>
                                        <button @click="copyToClipboard(lead.linkedin_url)" 
                                                class="bg-gray-600 hover:bg-gray-700 text-white text-xs font-medium py-1 px-3 rounded transition-colors">
                                            Copy URL
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="bg-gray-50 px-6 py-4 border-t">
                    <div class="flex justify-between items-center">
                        <p class="text-sm text-gray-600">
                            Click LinkedIn links to open profiles in new tabs
                        </p>
                        <button @click="closeModal()" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function dashboard() {
            return {
                stats: {},
                pendingMessages: [],
                showPending: false,
                showDebug: false,
                systemHealth: true,
                
                // Modal state
                showModal: false,
                modalTitle: '',
                currentState: '',
                modalLeads: [],
                loadingLeads: false,

                async loadData() {
                    try {
                        const response = await fetch('/dashboard/stats');
                        this.stats = await response.json();
                        
                        if (this.stats.pendingApprovals > 0) {
                            await this.loadPendingMessages();
                        }
                    } catch (error) {
                        console.error('Error loading data:', error);
                        this.systemHealth = false;
                    }
                },

                getStateCount(state) {
                    return this.stats.leadsByState?.[state] || 0;
                },

                async loadPendingMessages() {
                    try {
                        const response = await fetch('/api/messages/pending-approval');
                        const data = await response.json();
                        this.pendingMessages = data.messages || [];
                    } catch (error) {
                        console.error('Error loading pending messages:', error);
                    }
                },

                showPendingMessages() {
                    this.showPending = !this.showPending;
                    if (this.showPending && this.pendingMessages.length === 0) {
                        this.loadPendingMessages();
                    }
                },

                async approveMessage(messageId, approved) {
                    try {
                        const response = await fetch(`/api/messages/${messageId}/approve`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ approved })
                        });

                        if (response.ok) {
                            // Remove from pending list
                            this.pendingMessages = this.pendingMessages.filter(m => m.id !== messageId);
                            this.stats.pendingApprovals--;
                            
                            alert(approved ? 'Message approved and sent!' : 'Message rejected');
                        } else {
                            alert('Error processing approval');
                        }
                    } catch (error) {
                        console.error('Error approving message:', error);
                        alert('Error processing approval');
                    }
                },

                async bulkApprove(approved) {
                    if (!confirm(`Are you sure you want to ${approved ? 'approve' : 'reject'} all pending messages?`)) {
                        return;
                    }

                    try {
                        const messageIds = this.pendingMessages.map(m => m.id);
                        const response = await fetch('/api/messages/bulk-approve', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ messageIds, approved })
                        });

                        if (response.ok) {
                            this.pendingMessages = [];
                            this.stats.pendingApprovals = 0;
                            alert(`All messages ${approved ? 'approved' : 'rejected'} successfully!`);
                        } else {
                            alert('Error processing bulk approval');
                        }
                    } catch (error) {
                        console.error('Error bulk approving:', error);
                        alert('Error processing bulk approval');
                    }
                },

                editMessage(message) {
                    const newContent = prompt('Edit message content:', message.content);
                    if (newContent && newContent !== message.content) {
                        this.updateMessage(message.id, newContent);
                    }
                },

                async updateMessage(messageId, content) {
                    try {
                        const response = await fetch(`/api/messages/${messageId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ content })
                        });

                        if (response.ok) {
                            // Update in pending list
                            const message = this.pendingMessages.find(m => m.id === messageId);
                            if (message) {
                                message.content = content;
                            }
                            alert('Message updated successfully!');
                        } else {
                            alert('Error updating message');
                        }
                    } catch (error) {
                        console.error('Error updating message:', error);
                        alert('Error updating message');
                    }
                },

                // Modal functions
                async showLeadsModal(state, title) {
                    this.modalTitle = title;
                    this.currentState = state;
                    this.showModal = true;
                    this.loadingLeads = true;
                    this.modalLeads = [];

                    try {
                        const response = await fetch(`/dashboard/leads-by-state/${state}`);
                        const data = await response.json();
                        this.modalLeads = data.leads || [];
                    } catch (error) {
                        console.error('Error loading leads:', error);
                        alert('Error loading leads for this state');
                    } finally {
                        this.loadingLeads = false;
                    }
                },

                async showUnreadRepliesModal() {
                    this.modalTitle = 'üí¨ Unread Replies';
                    this.currentState = 'UNREAD_REPLIES';
                    this.showModal = true;
                    this.loadingLeads = true;
                    this.modalLeads = [];

                    try {
                        const response = await fetch('/dashboard/unread-replies');
                        const data = await response.json();
                        this.modalLeads = data.replies || [];
                    } catch (error) {
                        console.error('Error loading unread replies:', error);
                        alert('Error loading unread replies');
                    } finally {
                        this.loadingLeads = false;
                    }
                },

                closeModal() {
                    this.showModal = false;
                    this.modalLeads = [];
                    this.modalTitle = '';
                    this.currentState = '';
                },

                copyToClipboard(text) {
                    navigator.clipboard.writeText(text).then(() => {
                        // Simple feedback - you could make this fancier
                        const button = event.target;
                        const originalText = button.textContent;
                        button.textContent = 'Copied!';
                        setTimeout(() => {
                            button.textContent = originalText;
                        }, 1000);
                    }).catch(err => {
                        console.error('Failed to copy: ', err);
                        alert('Failed to copy URL');
                    });
                },

                // Show sent requests modal
                async showSentRequestsModal() {
                    const sentCount = this.stats.dailyLimits?.connection_requests_sent || 0;
                    this.modalTitle = `üìà Today's Connection Requests (${sentCount})`;
                    this.currentState = 'SENT_TODAY';
                    this.showModal = true;
                    this.loadingLeads = true;
                    this.modalLeads = [];

                    try {
                        const response = await fetch('/dashboard/sent-requests-today');
                        const data = await response.json();
                        this.modalLeads = data.requests || [];
                        
                        if (this.modalLeads.length === 0) {
                            this.modalTitle = `üìà Today's Connection Requests (0)`;
                        }
                    } catch (error) {
                        console.error('Error loading sent requests:', error);
                        alert('Error loading today\'s sent requests');
                    } finally {
                        this.loadingLeads = false;
                    }
                }
            }
        }

        // Auto-refresh every 30 seconds
        setInterval(() => {
            if (window.Alpine && window.Alpine.store) {
                // Refresh data automatically
                document.querySelector('[x-data="dashboard()"]').__x.$data.loadData();
            }
        }, 30000);
    </script>
</body>
</html>
